@using Microsoft.JSInterop

@inject IJSRuntime JS

<pre>
    <code @ref="codeElement" class="@LanguageClass">
        @Code
    </code>
</pre>

@code {
    [Parameter] public string? LanguageClass { get; set; }

    [Parameter] public string? Code { get; set; }

    private string? prevCode;

    private bool shouldHighlight = false;

    private ElementReference codeElement;

    protected override void OnParametersSet()
    {
        if (Code != prevCode && !string.IsNullOrWhiteSpace(Code))
        {
            prevCode = Code;
            shouldHighlight = true;
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (shouldHighlight)
        {
            shouldHighlight = false;
            await JS.InvokeVoidAsync("hljs.highlightElement", codeElement);
        }
    }
}